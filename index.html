<!DOCTYPE html>
<html>
<head>
<title>Esquiva Chuy</title>
<style>
    body {
        margin: 0;
        background: #87c8ff;
        font-family: Arial;
        user-select: none;
    }
    #gameContainer {
        position: relative;
        width: 900px;
        height: 300px;
        margin: auto;
        border: 2px solid black;
        background: #87c8ff;
        overflow: hidden;
    }
    #player {
        position: absolute;
        bottom: 60px;
        left: 50px;
        width: 60px;
        transition: transform 0.1s;
    }
    #cactus {
        position: absolute;
        bottom: 60px;
        width: 25px;
        height: 60px;
        background: green;
    }
    #ground {
        position: absolute;
        bottom: 0;
        width: 100%;
        height: 60px;
        background: #d6b56d;
    }
    #ui {
        margin-top: 10px;
        text-align: center;
    }
    #controlsText {
        position: fixed;
        bottom: 10px;
        left: 10px;
        background: rgba(255,255,255,0.7);
        padding: 6px 10px;
        border-radius: 6px;
        font-size: 14px;
    }
</style>
</head>
<body>

<h1 style="text-align:center; margin-top:20px;">Esquiva Chuy</h1>

<div id="gameContainer">
    <img id="player" src="chuy.png">

    <div id="ground"></div>
</div>

<div id="ui">
    <button onclick="changeSkin()">Cambiar Skin</button>
    <button onclick="restartGame()">Reiniciar</button>
    <p>Puntos: <span id="score">0</span></p>
</div>

<div id="controlsText">espacio para saltar  B para agacharse  R para reiniciar</div>

<script>
let player = document.getElementById("player");
let scoreText = document.getElementById("score");

let skins = ["chuy.png", "mangonio1.png"];
let currentSkin = 0;

let jumping = false;
let ducking = false;
let dead = false;
let canRestart = false;

let yVelocity = 0;
let gravity = 1;
let jumpPower = 18;  
let speed = 4;      
let speedIncrease = 0.001;

let cactus = null;
let cactusTimer = 0;

let score = 0;
let scoreSpeed = 0.2; // AHORA VA MAS LENTO

document.addEventListener("keydown", (e) => {
    if (e.code === "Space" && !jumping && !dead) {
        yVelocity = jumpPower;
        jumping = true;
        e.preventDefault();
    }
    if (e.key === "b" && !dead) {
        ducking = true;
        player.style.transform = "scale(1,0.6)";
    }
    if (e.key === "r") {
        if (dead && canRestart) {
            restartGame();
        }
    }
});

document.addEventListener("keyup", (e) => {
    if (e.key === "b") {
        ducking = false;
        player.style.transform = "scale(1,1)";
    }
});

function changeSkin() {
    currentSkin = (currentSkin + 1) % skins.length;
    player.src = skins[currentSkin];
}

function spawnCactus() {
    if (cactus) return;

    cactus = document.createElement("div");
    cactus.id = "cactus";
    cactus.style.right = "-40px";

    document.getElementById("gameContainer").appendChild(cactus);
}

function restartGame() {
    dead = false;
    canRestart = false;
    score = 0;
    speed = 4;
    player.src = skins[currentSkin];
    player.style.width = "60px";
    
    if (cactus) cactus.remove();
    cactus = null;
}

function gameLoop() {
    if (!dead) {
        score += scoreSpeed;
        scoreText.textContent = Math.floor(score);
        speed += speedIncrease;
    }

    if (!cactus && Math.random() < 0.02) {
        spawnCactus();
    }

    if (cactus) {
        let right = parseInt(cactus.style.right);
        cactus.style.right = right + speed + "px";

        if (right > 950) {
            cactus.remove();
            cactus = null;
        }
    }

    let bottom = parseInt(player.style.bottom);
    bottom += yVelocity;
    yVelocity -= gravity;

    if (bottom <= 60) {
        bottom = 60;
        jumping = false;
    }

    player.style.bottom = bottom + "px";

    if (cactus && !dead) {
        let px = player.offsetLeft;
        let py = player.offsetTop;
        let pw = player.offsetWidth;
        let ph = player.offsetHeight;

        let cx = cactus.offsetLeft;
        let cy = cactus.offsetTop;
        let cw = cactus.offsetWidth;
        let ch = cactus.offsetHeight;

        if (px < cx + cw &&
            px + pw > cx &&
            py < cy + ch &&
            py + ph > cy) {
            
            dead = true;
            canRestart = true;

            if (skins[currentSkin] === "mangonio1.png") {
                player.style.width = "120px";
            } else {
                player.style.width = "60px";
            }
        }
    }

    requestAnimationFrame(gameLoop);
}

gameLoop();
</script>

</body>
</html>
