<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8" />
<title>Esquiva Chuy</title>

<style>
    body {
        background: #8cc6ff;
        margin: 0;
        font-family: Arial, sans-serif;
        text-align: center;
        user-select: none;
    }

    #gameContainer {
        width: 800px;
        height: 300px;
        background: white; /* cielo blanco */
        margin: 30px auto 0 auto;
        border: 3px solid black;
        position: relative;
        overflow: hidden;
    }

    #suelo {
        position: absolute;
        bottom: 0;
        width: 100%;
        height: 60px;
        background: #e4c28b; /* arena */
    }

    #personaje {
        position: absolute;
        bottom: 60px;
        width: 55px;
        height: 55px;
        image-rendering: pixelated;
    }

    .cactus {
        position: absolute;
        bottom: 60px;
        width: 25px;
        height: 45px;
        background: #4a8f3b;
        border-radius: 6px;
    }

    #puntos {
        position: absolute;
        top: 5px;
        left: 5px;
        font-size: 18px;
        font-weight: bold;
    }

    #controles {
        position: absolute;
        bottom: 5px;
        left: 5px;
        font-size: 14px;
    }

    #selectorSkins {
        margin-top: 20px;
    }

    .skinBoton {
        padding: 10px 20px;
        margin: 5px;
        font-size: 18px;
        border: 2px solid black;
        background: white;
        cursor: pointer;
    }

</style>
</head>
<body>

<h1>Esquiva Chuy</h1>

<div id="gameContainer">
    <div id="puntos">0</div>
    <div id="controles">b para agacharse   r para reiniciarse</div>
    <img id="personaje" src="chuy.png">
    <div id="suelo"></div>
</div>

<div id="selectorSkins">
    <button class="skinBoton" onclick="cambiarSkin('chuy.png')">Chuy</button>
    <button class="skinBoton" onclick="cambiarSkin('mangonio.png')">Mangonio</button>
</div>

<script>
let personaje = document.getElementById("personaje");
let game = document.getElementById("gameContainer");

let velocidad = 7; // personaje mas rapido
let puntaje = 0;
let vivo = true;
let agachado = false;

// hitbox ajustada
let hitX = 10;
let hitY = 10;

let cactusList = [];

function cambiarSkin(skin){
    personaje.src = skin;
}

// crear cactus minimalistas
function crearCactus() {
    if (!vivo) return;

    let cactus = document.createElement("div");
    cactus.classList.add("cactus");
    cactus.style.left = "800px";

    let separacion = Math.floor(Math.random() * 200) + 200;

    cactus.vel = velocidad + (Math.random() * 2);

    game.appendChild(cactus);
    cactusList.push(cactus);

    setTimeout(crearCactus, separacion);
}

crearCactus();

// loop del juego
function loop() {
    if (!vivo) return;

    puntaje += 0.05; // puntaje lento
    document.getElementById("puntos").innerText = Math.floor(puntaje);

    // mover cactus
    for (let c of cactusList) {
        c.style.left = (parseInt(c.style.left) - c.vel) + "px";

        // colision
        let px = personaje.offsetLeft + hitX;
        let py = personaje.offsetTop + hitY;
        let pw = personaje.offsetWidth - hitX * 2;
        let ph = personaje.offsetHeight - hitY * 2;

        let cx = c.offsetLeft;
        let cy = c.offsetTop;
        let cw = c.offsetWidth;
        let ch = c.offsetHeight;

        if (px < cx + cw &&
            px + pw > cx &&
            py < cy + ch &&
            py + ph > cy) {
            morir();
        }
    }

    requestAnimationFrame(loop);
}

loop();

// agacharse
document.addEventListener("keydown", e => {
    if (e.key === "b") {
        if (!agachado) {
            agachado = true;
            personaje.style.height = "35px";
            personaje.style.bottom = "60px";
        }
    }

    if (e.key === "r") reiniciar();
});

document.addEventListener("keyup", e => {
    if (e.key === "b") {
        agachado = false;
        personaje.style.height = "55px";
        personaje.style.bottom = "60px";
    }
});

// morir
function morir() {
    vivo = false;
}

// reiniciar
function reiniciar() {
    location.reload();
}
</script>

</body>
</html>
